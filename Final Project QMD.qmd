---
title: "Final Project"
author: "Clarice Tee, Eddie Andujar, and Prashanthi Subbiah"
date: 12-07-2024
format: html
---
## Plot 1:
```{python}
import pandas as pd
import altair as alt
from vega_datasets import data
import json
# Load US states/divisions topology
states = alt.topo_feature(data.us_10m.url, 'states')
# Read the CSV file
df = pd.read_excel(r"C:\Users\clari\OneDrive\Documents\Python II\final_project\HC_11.1_with_PV_data.xlsx")
```

```{python}
# Example dataset
data_dict = {
    "region": ["Northeast", "Midwest", "South", "West"],
    "any_household_energy_insecurity": [3.69, 3.25, 4.66, 2.98],
    "total_cap_dc_region": [639.3, 687.3, 9848.64, 4006.8]
}

df = pd.DataFrame(data_dict)

# State-to-region mapping (FIPS codes based on U.S. GeoJSON)
state_region_mapping = {
    23: 'Northeast', 25: 'Northeast', 33: 'Northeast', 44: 'Northeast', 50: 'Northeast', 9: 'Northeast',
    34: 'Northeast', 36: 'Northeast', 42: 'Northeast',
    17: 'Midwest', 18: 'Midwest', 26: 'Midwest', 39: 'Midwest', 55: 'Midwest',
    19: 'Midwest', 20: 'Midwest', 27: 'Midwest', 29: 'Midwest', 31: 'Midwest', 38: 'Midwest', 46: 'Midwest',
    1: 'South', 5: 'South', 10: 'South', 12: 'South', 13: 'South', 21: 'South', 22: 'South', 24: 'South',
    28: 'South', 37: 'South', 40: 'South', 45: 'South', 47: 'South', 48: 'South', 51: 'South', 54: 'South',
    4: 'West', 8: 'West', 16: 'West', 30: 'West', 32: 'West', 35: 'West', 49: 'West', 56: 'West',
    2: 'West', 6: 'West', 15: 'West', 41: 'West', 53: 'West'
}

# Prepare state-to-region DataFrame
region_data = pd.DataFrame([
    {"id": fips, "region": region} for fips, region in state_region_mapping.items()
])

# Load US states GeoJSON
states = alt.topo_feature(data.us_10m.url, "states")
```


```{python}
# Updated chart with a descriptive title
region_map = alt.Chart(states).mark_geoshape().transform_lookup(
    lookup='id',
    from_=alt.LookupData(region_data, key='id', fields=['region'])
).transform_lookup(
    lookup='region',
    from_=alt.LookupData(df, key='region', fields=[
                         'any_household_energy_insecurity', 'total_cap_dc_region'])
).encode(
    color=alt.Color(
        'any_household_energy_insecurity:Q',
        scale=alt.Scale(scheme="reds"),
        title="Energy Insecurity (Millions of housing units)",
        legend=alt.Legend(
            labelFontSize=10,
            titleFontSize=12,
            orient="right",
            direction="vertical",
            titleLimit=300
        )
    ),
    tooltip=[
        alt.Tooltip('region:N', title="Region"),
        alt.Tooltip('any_household_energy_insecurity:Q',
                    title="Energy Insecurity (Millions of housing units)", format=".2f"),
        alt.Tooltip('total_cap_dc_region:Q', title="DC Capacity", format=".1f")
    ]
).project(
    type='albersUsa'
).properties(
    width=800,
    height=500,
    title={
        "text": "Energy Insecurity and DC Capacity Across US Regions",
        "fontSize": 16,
        "fontWeight": "bold",
        "anchor": "middle",  # Center the title
        "dy": -10            # Adjust the vertical position of the title
    }
)

# Manually specify approximate region centroids (Longitude, Latitude)
region_centroids = {
    "Northeast": {"lon": -73, "lat": 43},   # Northeast
    "Midwest": {"lon": -90, "lat": 41},     # Midwest
    "South": {"lon": -86, "lat": 34},       # South
    "West": {"lon": -115, "lat": 38}        # West
}

# Convert centroids to a DataFrame
centroids_df = pd.DataFrame([{"region": region, "lon": coords["lon"],
                            "lat": coords["lat"]} for region, coords in region_centroids.items()])

# Merge centroids with the existing dataset
df_with_centroids = pd.merge(df, centroids_df, on="region", how="left")

# Add Region Labels to the Map
region_labels = alt.Chart(df_with_centroids).mark_text(
    fontSize=12,
    fontWeight="bold",
    color="white",
    align="center"
).encode(
    longitude='lon:Q',
    latitude='lat:Q',
    text='region:N'
)

# Combine the Base Map and Region Labels without including conflicting config attributes
final_chart = region_map + region_labels

# Display the chart
final_chart.display()

```

## Plot 2:
```{python}
import pandas as pd
import altair as alt
from vega_datasets import data
import json
from altair_saver import save

# Read the CSV file
df = pd.read_excel(r"C:\Users\eddie\OneDrive\Documents\GitHub\final_project\HC_11.1_with_PV_data.xlsx")
```

```{python}
# Filter for division rows (exclude nulls)
division_df = df[df['division'].notna()].copy()

division_chart = alt.Chart(division_df).mark_point(
    size=200,  # Make points larger
    filled=True,  # Fill the points
    opacity=0.7  # Add some transparency
).encode(
    x=alt.X(
        'total_cap_ac_division:Q',
        title='Total AC Capacity (in megawatts)',
        scale=alt.Scale(zero=False, padding=50)  # Add padding to x-axis
    ),
    y=alt.Y(
        'any_household_energy_insecurity:Q',
        title='Energy Insecurity (Millions of housing units)',
        scale=alt.Scale(zero=False, padding=50)  # Add padding to y-axis
    ),
    color=alt.Color(
        'division:N',
        title='Division',
        scale=alt.Scale(scheme='tableau10')  # Use a color scheme for divisions
    ),
    tooltip=[
        alt.Tooltip('division:N', title='Division'),
        alt.Tooltip('total_cap_ac_division:Q', title='AC Capacity', format='.2f'),
        alt.Tooltip('any_household_energy_insecurity:Q', title='Energy Insecurity (Millions of housing units)', format='.2f')
    ]
).properties(
    width=800,  # Make chart wider
    height=500,  # Make chart taller
    title='Total AC Capacity vs Energy Insecurity by Division (megawatts)'
).interactive()

division_chart

```


```{python}
division_chart.save('plot2.png')
```

## Write-up:

Introduction
As climate change becomes more of an existential threat, a greater number of households worldwide will be affected by extreme weather shocks, food shortages, and displacement. However, efforts to mitigate climate change by reducing greenhouse gas emissions and switching to renewable energy sources such as solar also present a series of challenges. As solar energy becomes more of an imperative within the United States energy ecosystem, it’s important to better understand how this may impact household energy insecurity. We are particularly interested in knowing if a greater volume of high-capacity solar facilities within a region is indicative of how secure nearby households feel about their access to energy. In an ideal setting, more developed solar facilities may generate positive spillovers within their surrounding communities, facilitating access to solar while boosting perceptions of solar energy’s efficiency. However, we may also imagine a concerning scenario where investment in renewable energy infrastructure is funneling resources away from current energy accessibility, especially for low-income households. By visualizing the landscape of US solar infrastructure and analyzing how it correlates with nearby households’ energy insecurity, we hope to gain a better understanding of how, if at all, these two variables are connected.

Data and Methods
For our analysis, we worked with two key datasets. The first came from the US Energy Information Administration (EIA), a government agency operating with the express goal of surveying the public and collecting energy information for use in policy analysis alongside research and development. Their 2020 Residential Energy Consumption Survey (RECS) gathered data on housing characteristics such as fuel
consumption per household, air conditioning usage, and most importantly, energy insecurity. Broadly, energy insecurity refers to a household’s inability to meet basic energy needs. The EIA measured this value as an index linked to whether households had to forgo food or medicine to pay energy costs, had to leave home due to the temperature of the residence, or did not have access to heating or cooling equipment. Data was then grouped both demographically (age and ethnicity) and by region of the country. This allowed us to compile a comprehensive list of energy insecurity rates across the United States. Our second dataset came from the United States Geological Survey, a government agency focused on surveying natural resources and energy facilities. We used their geographic database on Solar Photovoltaic facilities, which compiled all major US solar production facilities by year, along with their production capacity, location, and starting date. These facilities are in charge of supplying solar power to the grid, making them pivotal components of solar infrastructure development in the US. For our analysis, we focused on each facility’s production capacity, serving as a proxy for their level of development. After carefully reviewing our datasets, we dropped missing values and aggregated the Solar PV data by region and regional subdivisions, mimicking the structure of the RECS data. We then restructured the RECS data to have a separate column denoting region and division, allowing us to merge the data on region and division. After this merge, each row in our dataframe represented one solar photovoltaic facility, along with both its region and division, and the relevant energy insecurity index of that given location.

Results
We first produced data visualizations that allowed us to get a better understanding of the energy insecurity landscape across the US.

PLOT 1

As we can see, energy insecurity appears to be far stronger in the South of the US. This may be due to weather conditions here such as greater humidity and increased susceptibility to heat waves. By contrast, the West has the lowest energy insecurity. The Northeast, the coldest region in the country, also displays an elevated level of energy insecurity. After having visualized the data, we moved on to producing a scatter plot that could help us answer our research question of interest: Is more solar power capacity a good indicator for how secure households near these plants felt about their energy? On the y-axis, we have the energy insecurity per millions of housing units within a particular region. On the x-axis is the cumulative AC capacity of all solar facilities within a given subregion:

PLOT 2

We do not appear to observe any kind of strong correlation between these two variables, which we believe is an interesting finding in and of itself. We will discuss this further within the conclusion section. Lastly, our shiny app allows us to zoom in on solar infrastructure within any region of interest in the country. Our slider allows us to filter by solar capacity, meaning we can isolate particularly high or low-performing plants in a given area. There is also the option to view the full US map at once.

Discussion and Conclusion
By seeing no correlation, the data seems to suggest that solar facility capacity is not a good predictor of energy insecurity, and that the above hypotheses may not be playing out as anticipated. This may be the case because of how far away these facilities are from residential areas, or may even be a sign that higher local expenditure in solar energy facilities is uncorrelated with higher expenditure on average household energy consumption. It may also be the case that regions across the US vary too much regarding weather conditions for solar energy provision to make any meaningful difference. For example, extreme heat waves in Texas or cold in Illinois may be issues that require more impactful weatherization efforts like repairing HVAC or sealing windows to alleviate.

The data analysis is indicative that more research ought to be done into the factors that influence energy insecurity. With renewables as the future of energy, we need to ensure their development is not leaving households behind. If we can find a way to pair renewable energy development with greater energy security for households, this may reinforce the importance of these sources of energy within the current ecosystem. If we were to run this analysis again, it may be interesting to observe how weatherization assistance programs may affect energy insecurity, although publicly available quantitative data is limited. We believe the greatest strength of our project lies in our map visualizations. These provide an easily accessible landscape for both energy insecurity and solar PV capacity, which could allow policymakers to more easily visualize which regions are most or least developed when it comes to renewable energy infrastructure.



